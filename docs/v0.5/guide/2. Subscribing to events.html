<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>2. Subscribing to events</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="2. Subscribing to events">2. Subscribing to events</a></h1>Event subscriptions can be configured in many different ways. <h2><a name="2.1 Annotations">2.1 Annotations</a></h2>You can configure subscriptions by adding annotations to your beans.<p class="paragraph"/><blockquote class="note">
Important! This will only work for Spring beans! 
</blockquote><p class="paragraph"/><blockquote class="warning">
This support is experimental and subject to change. 
</blockquote><p class="paragraph"/><div class="code"><pre>@HawkEventConsumer
class BookService &#123;<p class="paragraph"/>    @Consuming(<span class="java&#45;quote">"hibernate.save.book"</span>)
    void onNewBook(Event event) &#123;
        // <span class="java&#45;keyword">do</span> something with event.payload
    &#125;<p class="paragraph"/>&#125;</pre></div><h2><a name="2.2 Event configuration file">2.2 Event configuration file</a></h2>This was implemented to increase compatibility with Falcone Util. You can register events using a simple dsl in <code>grails-app/conf/events.groovy</code>.<p class="paragraph"/><div class="code"><pre>consumers = &#123;<p class="paragraph"/>    hibernate.book.created &#123; Event event &#45;&#62; 
        // Do something with book (event.payload)
    &#125;<p class="paragraph"/>&#125;</pre></div><h2><a name="2.3 Plugin descriptor">2.3 Plugin descriptor</a></h2>You can register events in the plugin descriptor. By adding a doWithEvents closure. The DSL is the same as the one used in events.groovy.<p class="paragraph"/><div class="code"><pre>def doWithEvents = &#123; ApplicationContext ctx &#45;&#62;<p class="paragraph"/>    hibernate.book.created &#123; Event event &#45;&#62; 
        // Do something with event.payload
    &#125;<p class="paragraph"/>&#125;</pre></div><h2><a name="2.4 Programmatically">2.4 Programmatically</a></h2>You can add your subscriptions during bean initialization.<p class="paragraph"/><h3>Simple event consumer using a closure</h3><p class="paragraph"/><div class="code"><pre>class BookService <span class="java&#45;keyword">implements</span> InitializingBean &#123;<p class="paragraph"/>    def eventBroker // Injected by Spring<p class="paragraph"/>    void afterPropertiesSet() &#123;
        eventBroker.subscribe(<span class="java&#45;quote">"hibernate.book"</span>) &#123; Event event &#45;&#62;
            // Do something with book (event.payload)
        &#125;
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><h3>Implement the EventConsumer interface</h3><p class="paragraph"/><div class="code"><pre>class MyConsumer <span class="java&#45;keyword">implements</span> EventConsumer, InitializingBean &#123;<p class="paragraph"/>    EventBroker eventBroker;<p class="paragraph"/>    void consume(Event event) &#123;
        // <span class="java&#45;keyword">do</span> something with the event 
    &#125;<p class="paragraph"/>    void afterPropertiesSet() &#123;
        eventBroker.subscribe(<span class="java&#45;quote">"hibernate.saveOrUpdate.author"</span>, <span class="java&#45;keyword">this</span>);
    &#125;<p class="paragraph"/>&#125;</pre></div>
    </body>
</html>
